cac.controller('demandeursController',function($scope,$http,$filter,$routeParams,$rootScope){var page=0;var shrch=false;var urlp=$rootScope.domainename;var url;var idd;$scope.resp=false;$scope.msg=false;$scope.id=-1;$scope.idm=$routeParams.id;$scope.mcsh='';$http.get(urlp+"alldepartements").success(function(data){$scope.departements=data;});$scope.nav=($routeParams.navr)?true:false;$routeParams.navr=$scope.nav;$scope.navsty=function(){$scope.nav=($scope.nav)?false:true;};function getData(){url=(shrch)?urlp+"chercherDemandeur?page="+page+"&mc="+$scope.mcsh:(($scope.idm)?urlp+"Alldemandeurs/"+$scope.idm:urlp+"demandeurs?page="+page);$http.get(url).success(function(data){$scope.demandeurs=data;if($scope.demandeurs.numberOfElements==0&&$scope.demandeurs.number>0){page=$scope.demandeurs.number-1;getData();}});}; $scope.suivente=function(){page=$scope.demandeurs.number+1;getData();};$scope.precedent=function(){page=$scope.demandeurs.number-1;getData();};$scope.sherch=function(){page=0;shrch=true;getData();};$scope.edit=function(ide){deman=filterProd(ide);$scope.id=ide;$scope.nom=deman.nom;$scope.matr=deman.matr;$scope.description=deman.description;$scope.departement_id=deman.departement.id;$scope.selected=ide;}; $scope.rest=function(){restForm();}; $scope.submit=function(){if($scope.id==-1){var data={nom:$scope.nom,matr:$scope.matr,description:$scope.description};$http.post(urlp+"demandeur/"+$scope.departement_id,JSON.stringify(data)).then(function(response){if(response.data){getData();restForm();$scope.resp=true;$scope.msg="Demandeur "+$scope.nom+" ajouter";}},function(response){$scope.msg="Demandeur "+$scope.nom+" non ajouter";$scope.resp=false;$scope.statusval=response.status;$scope.statustext=response.statusText;$scope.headers=response.headers();});}else{var data={id:$scope.id,nom:$scope.nom,matr:$scope.matr,description:$scope.description};$http.put(urlp+'demandeur/'+$scope.id+'/'+$scope.departement_id,JSON.stringify(data)).then(function(response){if(response.data){getData();$scope.resp=true;$scope.msg="Demandeur Modefier";}},function(response){$scope.msg="Error";getData();$scope.resp=false;$scope.statusval=response.status;$scope.statustext=response.statusText;$scope.headers=response.headers();});$scope.id=-1;}};$scope.delet=function(ids){if(ids<0){$http.delete(urlp+"demandeur/"+idd).then(function(response){getData();},function(response){$scope.merror="Désolé impossible de supprimer la demande";$('#ErrorModal').modal('show');});}else{per=filterProd(ids);$scope.msgsup="Voulez-vous vraiment supprimer "+per.nom+"?";idd=ids;}};function filterProd(ids){return($filter('filter')($scope.demandeurs.content,{id:ids})[0]);}; function restForm(){$scope.nom="";$scope.matr="";$scope.description="";$scope.msg="";$scope.resp=false;} getData();});