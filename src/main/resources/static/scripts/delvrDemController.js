cac.controller('delvrDemController',function($scope,$http,$filter,$routeParams,$rootScope){$scope.idd=$routeParams.id;$scope.produit;var urlp=$rootScope.domainename;$scope.msg;$scope.resp=false;$scope.demandeur;init();$scope.nav=($routeParams.navr)?true:false;$routeParams.navr=$scope.nav;$scope.navsty=function(){$scope.nav=($scope.nav)?false:true;};$scope.change=function(){$http.get(urlp+"produits/"+$scope.type_sel).success(function(data){$scope.produits=data;});$scope.dated=$filter('date')(new Date(),'dd/MM/yyyy');}; $scope.submit=function(){var data={date:filterDateu($scope.dated)};$http.post(urlp+'delivre/'+$scope.produit_sel+'/'+$scope.idd+'/'+$scope.numeros,JSON.stringify(data)).then(function(response){if(response.data){init();$scope.resp=true;$scope.msg="Le produit délivré";}},function(response){$scope.msg="Le produit non livré";$scope.resp=false;$scope.statusval=response.status;$scope.statustext=response.statusText;$scope.headers=response.headers();});}; $scope.libre=function(ids){if(ids<0){$http.get(urlp+"libreDemande/"+$scope.iddl).then(function(response){init();},function(response){});}else{demande=filterD(ids);$scope.msgsup="Voulez-vous vraiment libre le produit ?";$scope.iddl=ids;}};$scope.print=function(idd){var fileName="terminal.pdf";var a=document.createElement("a");document.body.appendChild(a);$http.get(urlp+'printdemande/'+idd,{responseType:'arraybuffer'}).then(function(response){var file=new Blob([response.data],{type:'application/pdf'});var fileURL=window.URL.createObjectURL(file);a.href=fileURL;a.download=fileName;a.click();});}; $scope.send=function(){var data={label:$scope.label,marque:$scope.marque,model:$scope.model,prix:$scope.prix,numeros:$scope.numeros,description:$scope.description,garantie:filterDateu($scope.garantie)};$http.post(urlp+'produit/'+$scope.type_sel,JSON.stringify(data)).then(function(response){if(response.data){init();restForm();$scope.resp=true;$scope.msg="Le produit "+$scope.label+" ajouter";}},function(response){$scope.msg="Le produit "+$scope.label+" non ajouter";$scope.resp=false;$scope.statusval=response.status;$scope.statustext=response.statusText;$scope.headers=response.headers();});}; $scope.nums=function(){$scope.produit=filterProduit($scope.produit_sel);$scope.numeros=$scope.produit.numeros;$http.get(urlp+"demandebypro/"+$scope.produit_sel).success(function(data){$scope.demande=data;$scope.demandeurde=findDelvre(true);});}; $scope.delet=function(ids){if(ids<0){$http.delete(urlp+"demande/"+idd).then(function(response){init();},function(response){alert("Le demandeur relier à des demandes");});}else{demande=filterDemande(ids);$scope.msgsup="Voulez-vous vraiment supprimer la demande ?";idd=ids;}};$scope.rest=function(){restForm();}; function restForm(){$scope.produit_sel="";$scope.numeros="";$scope.dated="";$scope.msg="";$scope.resp=false;$scope.demandeurde=false;$scope.type_sel="";}; function init(){$http.get(urlp+"demandebydemandeur/"+$scope.idd).success(function(data){$scope.demandes=data;});$http.get(urlp+"demandeur/"+$scope.idd).success(function(data){$scope.demandeur=data;});$http.get(urlp+"AllTypes").success(function(data){$scope.types=data;});$scope.dated=$filter('date')(new Date(),'dd-MM-yyyy');}; function filterDemande(ids){return($filter('filter')($scope.demandes,{id:ids})[0]);}; function filterD(ids){return($filter('filter')($scope.demandes,{id:ids})[0]);}; function filterProduit(idp){return($filter('filter')($scope.produits.content,{id:idp})[0]);}; function findDelvre(dl){return($filter('filter')($scope.demande,{delvre:dl})[0]);}; function filterDate(date){var dates=date.split("-");return dates[2]+"/"+dates[1]+"/"+dates[0];}; function filterDateu(date){var dates=date.split("/");return dates[2]+"-"+dates[1]+"-"+dates[0];}});