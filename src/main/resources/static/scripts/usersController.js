cac.controller('userscontroller',function($scope,$http,$filter,$rootScope,$routeParams){var page=0;var shrch=false;var url;var idd;var urlp=$rootScope.domainename;$scope.resp=false;$scope.msg=false;$scope.id=-1;$scope.mcsh='';$scope.validation=true;$scope.sendData=false;$scope.nav=($routeParams.navr)?true:false;$routeParams.navr=$scope.nav;$scope.navsty=function(){$scope.nav=($scope.nav)?false:true;};function getData(){url=urlp+"user?mc="+$scope.mcsh+"&page="+page;$http.get(url).success(function(data){$scope.users=data;if($scope.users.numberOfElements==0&&$scope.users.number>0){page=$scope.users.number-1;getData();}});}; $scope.suivente=function(){page=$scope.users.number+1;getData();};$scope.precedent=function(){page=$scope.users.number-1;getData();};$scope.sherch=function(){page=0;shrch=true;getData();};$scope.edit=function(ide){user=filterList(ide);$scope.id=ide;$scope.nom=user.nom;$scope.email=user.email;$scope.active=user.active;}; $scope.rest=function(){restForm();}; function restForm(){$scope.anom="";$scope.aemail="";$scope.active=false;$scope.apassword="";$scope.acpassword="";$scope.resp=false;$scope.msg="";$scope.validation=true;$scope.sendData=false;}; function sendUser(){if($scope.apassword&&($scope.apassword==$scope.acpassword)&&$scope.aemail&&$scope.anom){$scope.sendData=true;var data={nom:$scope.anom,email:$scope.aemail,active:$scope.aactive,password:$scope.apassword};$http.post(urlp+'user',JSON.stringify(data)).then(function(response){if(response.data){getData();reslt=response.data;if(reslt=="ajut"){restForm();$scope.resp=true;$scope.msg="Utilisateur "+$scope.anom+" ajouter";$scope.validation=true;$scope.sendData=false;}else if(reslt=="error"){$scope.resp=false;$scope.msg="E-mail "+$scope.aemail+" existe ";$scope.validation=true;$scope.sendData=false;}}},function(response){$scope.msg="Utilisateur "+$scope.label+" non ajouter";$scope.resp=false;$scope.sendData=false;$scope.statusval=response.status;$scope.statustext=response.statusText;$scope.headers=response.headers();});}else{$scope.msg="Touts obligatoire";$scope.resp=false;$scope.validation=false;}}; $scope.post=function(){sendUser();}; $scope.submit=function(){var data={id:$scope.id,nom:$scope.nom,email:$scope.email,active:$scope.active};$http.put(urlp+'user/'+$scope.id,JSON.stringify(data)).then(function(response){if(response.data){getData();$scope.resp=true;$scope.msg="Utilisateur Modefier";}},function(response){$scope.msg="Error";getData();$scope.resp=false;$scope.statusval=response.status;$scope.statustext=response.statusText;$scope.headers=response.headers();});};$scope.delet=function(ids){if(ids<0){$http.delete(urlp+"user/"+idd).then(function(response){getData();},function(response){$scope.merror="Désolé impossible de supprimer utilisateur";$('#ErrorModal').modal('show');});}else{user=filterList(ids);$scope.msgsup="Voulez-vous vraiment supprimer utilisateur "+user.nom+"?";idd=ids;}};function filterList(ids){return($filter('filter')($scope.users.content,{id:ids})[0]);}; function emailvalid(){var EMAIL_REGEXP=/^[_a-z0-9]+(.[_a-z0-9]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,4})$/;if(EMAIL_REGEXP.test($scope.aemail))return true;else false;} getData();});